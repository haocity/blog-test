"use strict";function init(){city.api="https://t5.haotown.cn/blogapi/",localStorage.getItem("love")?city.love=JSON.parse(localStorage.getItem("love")):city.love=new Array,city.loadp=10,city.s=0,city.e=city.s+city.loadp,city.footer=document.querySelector(".footer"),creatul(),getQueryString("pid")?loadallone(getQueryString("pid")):getQueryString("class")?(city.class=escape(getQueryString("class")),loadpage(city.s,city.e)):loadpage(city.s,city.e)}function creatul(){var t=["首页","日常","技术","软件"],e=document.createElement("div");e.className="nav";for(var n=0;n<t.length;n++){var o=document.createElement("li"),i=document.createElement("a");i.href="首页"==t[n]?"index.html":"index.html?class="+t[n],i.innerText=t[n],i.title=t[n],o.appendChild(i),e.appendChild(o)}document.querySelector("nav.main-width").appendChild(e)}function uplove(t){city.love.push(t),localStorage.setItem("love",JSON.stringify(city.love))}function islove(t){for(var e=0;e<city.love.length;e++)if(city.love[e]==t)return!0;return!1}function xhr(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return new Promise(function(o,i){try{var a=new XMLHttpRequest;a.onreadystatechange=function(){4==a.readyState&&200==a.status?o(a.responseText):4==a.readyState&&i(a.status)},a.open(e,t,!0),a.send(n)}catch(t){}})}function loadpage(t,e,n){var o="";city.class&&(o="&class="+city.class),xhr(city.api+"page?s="+t+"&e="+e+o).then(function(t){var e=JSON.parse(t);if(200==e.code){console.log("加载成功");for(var o=e.data,i=document.querySelector(".container "),a=0;a<o.length;a++){var s=o[a];s.commentsnumber||(s.commentsnumber=""),i.appendChild(creatpost(s.title,s.briefly,s.time,s.classify,s.commentsnumber,s.love,s.pid,null,s.md)),n&&n()}o.length!=city.loadp&&(city.footer.style.display="block",city.isend=!0)}})}function loadone(t){xhr(city.api+"post?id="+t.pid).then(function(e){var n=JSON.parse(e);if(200==n.code){var o=t.querySelector(".post-con");o.className="post-con all",o.onclick="",t.md?o.innerHTML=marked(n.data):o.innerHTML=n.data,t.querySelector(".post-showall-btn").style.display="none"}})}function loadallone(t){xhr(city.api+"one?id="+t).then(function(t){var e=JSON.parse(t);e.commentsnumber||(e.commentsnumber=""),city.isend="true",city.footer.style.display="block";var n=document.querySelector(".container "),o=creatpost(e.title,e.data,e.time,e.classify,e.commentsnumber,e.love,e.pid,"all",e.md);n.appendChild(o),opencom(o)})}function opencom(t){var e=t.querySelector(".post-ex");t.hco?(e.innerHTML="",t.hco=!1):(new Hco(e,"blog",t.pid),t.hco=!0)}function getQueryString(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)","i"),n=window.location.search.substr(1).match(e);return null!=n?unescape(n[2]):null}function creatpost(t,e,n,o,i,a,s,c,l){var r=document.createElement("div"),d=void 0,p=void 0;return islove(s)&&(a="已"),l?(p=marked(e),r.md=!0):p=e,d=c&&"all"==c?'<div class="post-con all">'+p+"</div>":'<div class="post-con small" onclick="loadone(this.parentNode)">'+p+'</div>\n\t\t\t\t<div class="post-showall-btn pointer">阅读全文 <svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-down"></use></svg></div>',r.className="box post",r.innerHTML='<h2 class="title"><a href="?pid='+s+'" target="_blank">'+t+"</a></h2>\n\t\t\t\t"+d+'\n\t\t\t\t<div class="post-bottom">\n\t\t\t\t\t<div class="post-bottom-time">发表于'+gettime(n)+'</div>\n\t\t\t\t\t<div class="post-bottom-classify"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-icon-class"></use></svg>分类:'+o+'</div>\n\t\t\t\t\t<div class="post-bottom-comnum pointer"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-comment"></use></svg>'+i+'评论</div>\n\t\t\t\t\t<div class="post-bottom-love pointer"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-love1"></use></svg><span>'+a+'喜欢</span></div>\n\t\t\t\t\t<div class="post-bottom-share pointer"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-share"></use></svg>分享</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="post-ex"></div>\n\t\t\t\t',r.pid=s,r}function gettime(t){var e=void 0,n=new Date,o=n.getTimezoneOffset(),i=(new Date).getTime(),a=i-t-6e4*o;if(a<6e4)e="刚刚";else if(a<36e5)e=new Date(a).getMinutes()+"分钟前";else if(a<864e5)e=new Date(a).getHours()+"小时前";else{var s=new Date(parseInt(t));e=s.getFullYear()+"年"+(s.getMonth()+1)+"月"+s.getDate()+"日"}return e}var city=new Object;document.querySelector(".container").addEventListener("click",function(t){var e=t.target;"SPAN"==e.nodeName&&(e=e.parentNode),"use"==e.nodeName&&(e=e.parentNode),"svg"==e.nodeName&&(e=e.parentNode),e.classList.contains("pointer")&&(e.classList.contains("post-bottom-comnum")?opencom(e.parentNode.parentNode):e.classList.contains("post-bottom-love")?e.love||(e.love=!0,e.querySelector("span").innerHTML="已喜欢",uplove(e.parentNode.parentNode.pid),xhr(city.api+"love?id="+e.parentNode.parentNode.pid).then(function(t){console.log(t)})):e.classList.contains("post-bottom-share")||e.classList.contains("post-showall-btn")&&loadone(e.parentNode))}),document.addEventListener("scroll",function(){document.documentElement.clientHeight+document.documentElement.scrollTop>=document.documentElement.offsetHeight-30&&(city.isload||(console.log("加载下一页"),city.isload=!0,city.s+=city.loadp,city.e=city.s+city.loadp,city.isend||loadpage(city.s,city.e,function(){city.isload=!1})))}),init();